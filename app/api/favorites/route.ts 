import { kv } from '@vercel/kv';
import { NextRequest, NextResponse } from 'next/server';

export async function POST(req: NextRequest) {
  const { user_id, list } = await req.json() as { user_id?: string; list?: string[] };

  if (!user_id || !Array.isArray(list)) {
    return NextResponse.json({ error: 'Bad request' }, { status: 400 });
  }

  await kv.set(`user:${user_id}:favorites`, JSON.stringify(list));
  return NextResponse.json({ ok: true });
}

export async function GET(req: NextRequest) {
  const user_id = new URL(req.url).searchParams.get('user_id');
  if (!user_id) {
    return NextResponse.json({ error: 'Missing user_id' }, { status: 400 });
  }

  const raw = await kv.get<string>(`user:${user_id}:favorites`);
  return NextResponse.json(raw ? JSON.parse(raw) : []);
}
